AC_PREREQ(2.52)

AC_INIT(gnome-power-manager, 0.1.1)
AC_CONFIG_SRCDIR(src)
AM_INIT_AUTOMAKE(AC_PACKAGE_NAME, AC_PACKAGE_VERSION)
AM_CONFIG_HEADER(config.h)

AC_PROG_CC
AC_PROG_INSTALL
AM_PROG_LIBTOOL

ALL_LINGUAS="de en_CA en_GB es fr mk nb no pa sv zh_CN"
AC_SUBST(ALL_LINGUAS)

AC_DEFINE(GETTEXT_PACKAGE, "AC_PACKAGE_NAME", [foo])
GETTEXT_PACKAGE=AC_PACKAGE_NAME
AC_SUBST(GETTEXT_PACKAGE)

AC_PROG_INTLTOOL([0.27.2])
AM_GLIB_GNU_GETTEXT

AC_ARG_ENABLE(libnotify,          [  --enable-libnotify        build with libnotify support],enable_libnotify=$enableval,enable_libnotify=auto)

PKG_CHECK_MODULES(GLIB, glib-2.0 gobject-2.0)
AC_SUBST(GLIB_CFLAGS)
AC_SUBST(GLIB_LIBS)

PKG_CHECK_MODULES(HAL, hal >= 0.5.0)
AC_SUBST(HAL_CFLAGS)
AC_SUBST(HAL_LIBS)

PKG_CHECK_MODULES(DBUS, dbus-glib-1 >= 0.35.2 dbus-1 >= 0.35.2 gthread-2.0)
AC_SUBST(DBUS_CFLAGS)
AC_SUBST(DBUS_LIBS)

PKG_CHECK_MODULES(GNOME, libgnomeui-2.0 libglade-2.0 libwnck-1.0 >= 2.1.5 gtk+-2.0 >= 2.6.0)
AC_SUBST(GNOME_CFLAGS)
AC_SUBST(GNOME_LIBS)

AC_PATH_PROG(GCONFTOOL, gconftool-2)
AM_GCONF_SOURCE_2

CPPFLAGS="$CPPFLAGS -ansi -Wall"
LDFLAGS="$LDFLAGS -ansi -Wall"

# libnotify detection
if test x$enable_libnotify = xno ; then
    have_libnotify=no;
else
    # See if we have sufficiently new libnotify library
    #AC_CHECK_LIB(libnotify, libnotify_removable_context_path, 
    #             have_libnotify=yes, have_libnotify=no)
    PKG_CHECK_MODULES(LIBNOTIFY, libnotify >= 0.0.1, have_libnotify=yes, have_libnotify=no)

    if test x$enable_libnotify = xauto ; then
        if test x$have_libnotify = xno ; then
                AC_MSG_WARN([Sufficiently new libnotify library not found])
        fi
    else 
        if test x$have_libnotify = xno ; then
                AC_MSG_ERROR([libnotify explicitly required, and sufficiently new libnotify library not found])
        fi
    fi
fi

AM_CONDITIONAL(HAVE_LIBNOTIFY, test x$have_libnotify = xyes)

if test x$have_libnotify = xyes ; then
    AC_DEFINE(HAVE_LIBNOTIFY,1,[libnotify support])
fi

AC_OUTPUT([
Makefile
src/Makefile
src/pixmaps/Makefile
src/sounds/Makefile
src/icons/Makefile
po/Makefile.in
gnome-power.spec
])

dnl ==========================================================================
echo "
                    GNOME Power Manager $VERSION
                  =============================

        prefix:                   ${prefix}
        compiler:                 ${CC}
        cflags:                   ${CFLAGS}
        cppflags:                 ${CPPFLAGS}
        libnotify support:        ${have_libnotify}
"
