<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html>
<head>
 <title>GNOME Power Manager</title>
 <link rel="stylesheet" href="index.css" type="text/css" />
</head>
<body>

<center>
<img src="images/logo.png">
</center>

<p>
GNOME Power Manager gets all information from HAL using information from org.freedesktop.Hal.
GNOME Power Manager does not do independent probing for data, it relies on HAL, in this way it can stay very lightweight and uncomplicated.
</p>
<p>
GNOME Power Manager owns the session D-BUS service net.sf.GnomePower and runs a session daemon (i.e. once per logged in user) and optionally displays battery status and low battery notifications. 
</p>
<p>
Each action in the right-click menu can be disabled in DBUS, to limit users to performing 'safe' commands from the desktop. e.g. If hibernate is known to crash on a specific Toshiba laptop, it can be disabled in gconf, but still allowing the user to suspend, shutdown etc.
</p>
<center>
<img src="images/gconf.png">
</center>
<p class="caption">
Lockdown possible via gconf
</p>
<p>
It is expected that HAL will provide the data that allows GPM to decide what options are available.
</p>
<h3>Notification Icon</h3>
<p>
The notification icon can display a device in the tray.
The icons can be themed with custom icons for each theme, or fallback to a standard default.
<center>
<img src="images/gpm-taskbar.png">
<img src="images/demo.png">
</center>
<p class="caption">
Existing output of the notification area icon, and the planned new tooltip design.
</p>

<center>
<img src="images/drop-down.png">
</center>
<p class="caption">
Example right-click menu that gives the options and actions
</p>

<h3>Methods</h3>

<p>
The methods provided by GPM are provided for client programs to use.
</p>
<pre>
bool isUserIdle ()
bool isRunningOnMains ()
bool isActive ()
</pre>

<h3>Server Signals</h3>

<p>
The signals are emitted when state is changed or an action is about to happen.
</p>
<pre>
mainsStatusChanged (bool isRunningOnMains)
userIdleStatusChanged (bool isIdle)
actionAboutToHappen (enum action)
performingAction (enum action)
</pre>

<p>
Action is defined as: 
</p>

<pre>
SCREENSAVE =  1, 
POWEROFF   =  2, 
SUSPEND    =  4, 
HIBERNATE  =  8, 
LOGOFF     =  16, 
ALL        =  255
</pre>

<h3>Client Signals</h3>

<p>
Client signals are sent from an application to GPM.
If an application registers its interest in a action, it is given the chance to ack, or nack the situation.
</p>
<p>
The situation:
User presses shutdown, but Abiword has an unsaved document open.
Abiword is informed of the impending shutdown, but issues a nack, followed by a screen that asks the user if he would like to save the document.
It can then resume the shutdown using the signal ack.
</p>
<p>
Similarly, if Evolution is indexing a database (that would be corrupted if interrupted) and needs at least 3 seconds to flush buffers, it can pause the shutdown using wait.
The signals currently available are:
</p>

<pre>
vetoActionRegisterInterest (enum action, gchar localizedAppname)
vetoActionUnregisterInterest (enum action)
vetoACK (enum action)
vetoNACK (enum action, gchar localizedReason)
vetoWait (enum action, int timeout, gchar localizedReason)
</pre>

<p>
This part of GNOME Power Manager has a test suite, gnome-power-dbus-test that can be used to test the out-of-order and error conditions.
It also shows any limitations or bugs in GNOME Power Manager. For example, running gnome-power-dbus-test --doNACK and selecting shutdown from the drop down menu would give the following dialog from GPM:
</p>

<center>
<img src="images/nack-sunday.png">
</center>
<p class="caption">
The error message from the GNOME Power Manager.
</p>

<p>
This message should probably be a persistent tooltip, but for the moment serves the purposes of testing very well.
</p>

<h2>GNOME Power Preferences</h2>

<p>
Power preferences is a simple program that lets the authorized user change the actions associated with each action. 
Devices that are not present are not shown, e.g. the UPS options are not visible to the user, unless one is plugged in, similarly, battery options are hidden for desktop users.
</p>

<center>
<img src="images/pref-main.png">
<img src="images/pref-options.png">
</center>
<p class="caption">
Preferences options
</p>

<h2>Getting The Code</h2>

<p>
The latest 'stable' code can be found at https://sourceforge.net/project/showfiles.php?group_id=133929
For the moment, you will have to run GNOME Power Manager from a terminal (it will not autostart.) but will hopefully be either patched into the default upstream startup, or will use gnome-services when it arrives in mainline.
</p>
<center>
<img src="images/gnome-session.png">
</center>
<p class="caption">
You can launch gnome-power-manager automatically using the gnome-session-properties program
</p>


<h2>Getting The Code</h2>
<p>
The latest 'stable' code can be found at https://sourceforge.net/project/showfiles.php?group_id=133929
</p>
<p>
RPM's suitable for a Fedora Core 4 can also be found here.
</p>
<p>
You can check out the latest GNOME Power Manager code using CVS:<br>
</p>
<pre>
export CVSROOT=":pserver:anonymous@anoncvs.gnome.org:/cvs/gnome"
cvs -z3 checkout gnome-power-manager
</pre>

<h3>jhbuild</h3>

<p>
If you want to use GNOME CVS, jhbuild can now build GNOME Power Manager using:
</p>
<pre>
jhbuild build gnome-power
</pre>

</body>
</html>
