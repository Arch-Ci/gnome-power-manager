<?xml version="1.0"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" 
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
]>
<article id="index">
  <articleinfo>
    <title>Power Management Specification (WITH GNOME ADDITIONS)</title>
    <releaseinfo>Version CRACKtastic</releaseinfo>
    <date>March 26 2007</date>
    <authorgroup>
      <author>
        <firstname>Richard</firstname>
        <surname>Hughes</surname>
        <affiliation>
          <address>
            <email>richard@hughsie.com</email>
          </address>
        </affiliation>
      </author>
    </authorgroup>
  </articleinfo>

  <sect1 id="dbus">
    <title>DBUS API</title>
    <para>
      The interfaces are session-wide.
    </para>

    <informaltable>
      <tgroup cols="2">
        <tbody>
          <row>
            <entry>DBUS Service:</entry>
            <entry><literal>org.freedesktop.PowerManagement</literal></entry>
          </row>
          <row>
            <entry>DBUS Path:</entry>
            <entry><literal>/org/freedesktop/PowerManagement</literal></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <sect2 id="dbus-methods">
      <title>Methods</title>
      <para>
        Methods on interface <literal>org.freedesktop.PowerManagement</literal>
        define a base layer for interoperability.
        Other optional interfaces may be proposed in the future for other
        aspects of session power management.
      </para>

      <table id="dbus-methods-core">
        <title>Methods on interface <literal>org.freedesktop.PowerManagement</literal></title>
        <tgroup cols="4">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Input Parameters</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>Standby</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry>Attempt to put the system in standby.</entry>
            </row>
            <row>
              <entry><literal>Suspend</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry>Attempt to suspend the system.</entry>
            </row>
            <row>
              <entry><literal>Hibernate</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry>Attempt to hibernate the system.</entry>
            </row>
            <row>
              <entry><literal>Shutdown</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry>Attempt to shutdown the system.</entry>
            </row>
            <row>
              <entry><literal>Reboot</literal></entry>
              <entry></entry>
              <entry></entry>
              <entry>Attempt to reboot the system.</entry>
            </row>
            <row>
              <entry><literal>CanStandby</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> can_standby</entry>
              <entry>If the current session user is able to put the system in standby.</entry>
            </row>
            <row>
              <entry><literal>CanSuspend</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> can_suspend</entry>
              <entry>If the current session user is able to suspend the system.</entry>
            </row>
            <row>
              <entry><literal>CanHibernate</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> can_hibernate</entry>
              <entry>If the current session user is able to hibernate the system.</entry>
            </row>
            <row>
              <entry><literal>CanShutdown</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> can_shutdown</entry>
              <entry>If the current session user is able to shutdown the system.</entry>
            </row>
            <row>
              <entry><literal>CanReboot</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> can_reboot</entry>
              <entry>If the current session user is able to reboot the system.</entry>
            </row>
            <row>
              <entry><literal>GetPowerSaveStatus</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> save_power</entry>
              <entry>
                This may be set on AC or battery power, both, or neither
                depending on the users preference setting.
                This setting may also change with the battery level changing.
                Programs should respect this value and not perform non-essential
                tasks when we are trying to save power.
              </entry>
            </row>
            <row>
              <entry><literal>GetBatteryState</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> on_battery</entry>
              <entry>
                Returns the system power state, i.e. if we are running on
                battery power.
                This method may still return true on AC using a desktop system
                if the computer is using backup power from a monitored UPS.
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <para>
        The <literal>org.freedesktop.PowerManagement.XXXBacklight</literal>
        interface is optional, and allows a UI element to interact with
        the session daemon without using HAL directly.
      </para>
      <para>
        By using the session dameon, rather than HAL any UI can have
        preference settings saved, without two policies being forced on one device.
      </para>

      <table id="dbus-methods-backlight">
        <title>Methods on interface <literal>org.freedesktop.PowerManagement.XXXBacklight</literal></title>
        <tgroup cols="4">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Input Parameters</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>GetBacklightBrightness</literal></entry>
              <entry></entry>
              <entry><literal>uint</literal> percentage_brightness</entry>
              <entry>Returns the current backlight brightness as a percentage.</entry>
            </row>
            <row>
              <entry><literal>SetBacklightBrightness</literal></entry>
              <entry><literal>uint</literal> percentage_brightness</entry>
              <entry></entry>
              <entry>
                This may not immediately set the brightness if we are in a
                low power sleep mode, if the panel is switched off, or if the
                panel is in an idle dim state.
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <para>
        The <literal>org.freedesktop.PowerManagement.XXXWidget</literal>
        interface is optional, and allows a UI element to display the state
        of the system.
      </para>
      <para>
        Some user interface front-ends will be in a different process to that
        of any power manager and system state will have to be transmitted
        over DBUS.
      </para>
      <para>
        Only the final 'result' (the icon and description) is exported
        as presenting an abstract power interface is wrong for this functionality.
        These are the required DBUS methods for presenting an interface to the
        user.
      </para>

      <table id="dbus-methods-widget">
        <title>Methods on interface <literal>org.freedesktop.PowerManagement.XXXWidget</literal></title>
        <tgroup cols="4">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Input Parameters</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>GetDescription</literal></entry>
              <entry></entry>
              <entry><literal>string</literal> description</entry>
              <entry>System state description, e.g. Laptop battery 34 minutes until charged (34%).</entry>
            </row>
            <row>
              <entry><literal>GetIcon</literal></entry>
              <entry></entry>
              <entry><literal>string</literal> icon</entry>
              <entry>Icon name, e.g. gpm-primary-080-charging</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <para>
        When the power manager detects an idle session and system, it can perform
        a system suspend or hibernate, known as a system sleep.
        We can prevent the power manager doing this action, if for instance
        we are doing a slow network copy that will take many hours.
        These are the required DBUS methods for inhibiting system sleep.
      </para>
      <para>
        A cookie is a random 32bit unsigned integer used to identify the inhibit.
        It is required as the same application may want to call inhibit
        multiple times, without managing the inhibit calls itself.
      </para>

      <table id="dbus-methods-inhibit">
        <title>Methods on interface <literal>org.freedesktop.PowerManagement.XXXInhibit</literal></title>
        <tgroup cols="4">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Input Parameters</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>InhibitAuto</literal></entry>
              <entry><literal>string</literal> application, <literal>string</literal> reason</entry>
              <entry><literal>uint</literal> cookie</entry>
              <entry>
                Inhibits the computer from performing the idle sleep action.
                Useful if you want to do an operation of long duration without the
                computer suspending.
                Reason and application should be translated strings where possible.
              </entry>
            </row>
            <row>
              <entry><literal>InhibitManual</literal></entry>
              <entry><literal>string</literal> application, <literal>string</literal> reason</entry>
              <entry><literal>uint</literal> cookie</entry>
              <entry>
                Inhibits the computer from performing the any sleep or shutdown action.
                Useful if you want to perform an operation that cannot be interrupted like
                a firmware re-flash or RPM transaction.
              </entry>
            </row>
            <row>
              <entry><literal>UnInhibit</literal></entry>
              <entry><literal>uint</literal> cookie</entry>
              <entry></entry>
              <entry>
                Allows the computer to perform the idle sleep or user action is the
                number of inhibit calls is zero.
                If there are multiple cookies outstanding, clearing one cookie
  	        does not allow the action to happen.
                If the program holding the cookie exits from the system bus without
                calling <literal>UnInhibit()</literal> then it is automatically removed.
              </entry>
            </row>
            <row>
              <entry><literal>IsValid</literal></entry>
              <entry></entry>
              <entry><literal>bool</literal> valid</entry>
              <entry>
                Returns true if we have no valid manual or automatic inhibitors.
                This will return false if the number of inhibit cookies
                is greater than zero.
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <para>
        Statistics data is values that can be collected by the power manager
        for review or profiling.
        These are important (but not required) methods allow the profiling
        of power saving methods, for instance showing on a graph that 20% more
        power is saved using certain CPU schedulers.
        These are optional DBUS methods for getting system statistics.
      </para>

      <table id="dbus-methods-statistics">
        <title>Methods on interface <literal>org.freedesktop.PowerManagement.XXXStatistics</literal></title>
        <tgroup cols="4">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Input Parameters</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>GetDataTypes</literal></entry>
              <entry></entry>
              <entry><literal>list of strings [as]</literal> types</entry>
              <entry>
                Gets a list of the types of data available.
                Data types are single strings that represent the complete data
                and do not indicate the axis, e.g. [ 'voltage', 'power', 'percentage' ]
              </entry>
            </row>
            <row>
              <entry><literal>GetAxisTypes</literal></entry>
              <entry><literal>string</literal> data_type</entry>
              <entry><literal>string</literal> x_axis, <literal>string</literal> y_axis</entry>
              <entry>
                For some presentations, for example graphs we can present the data in
                many different ways.
                This method returns the type of data that is recorded for each axis,
                e.g. x_axis might return 'percentage'
              </entry>
            </row>
            <row>
              <entry><literal>GetData</literal></entry>
              <entry><literal>uint</literal> seconds, <literal>string</literal> data_type</entry>
              <entry><literal>array of 3-integers [a(iii)]</literal> data</entry>
              <entry>
                Gets the data for a given type.
                In the return data the 3-integers represent the X value, Y value
                and data value respectively.
                The seconds parameter is how much data we should get.
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>

    </sect2>

    <sect2 id="dbus-signals">
      <title>Signals</title>
      <para>
        Signals are emitted from interface <literal>org.freedesktop.PowerManagement</literal>.
      </para>

      <table id="dbus-signals-core">
        <title>Signals emitted from interface <literal>org.freedesktop.PowerManagement</literal></title>
        <tgroup cols="3">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>CanStandbyChanged</literal></entry>
              <entry><literal>bool</literal> can_standby</entry>
              <entry>Signals the standby status has changed.</entry>
            </row>
            <row>
              <entry><literal>CanSuspendChanged</literal></entry>
              <entry><literal>bool</literal> can_suspend</entry>
              <entry>Signals the suspend status has changed.</entry>
            </row>
            <row>
              <entry><literal>CanHibernateChanged</literal></entry>
              <entry><literal>bool</literal> can_hibernate</entry>
              <entry>Signals the hibernate status has changed.</entry>
            </row>
            <row>
              <entry><literal>CanShutdownChanged</literal></entry>
              <entry><literal>bool</literal> can_shutdown</entry>
              <entry>Signals the shutdown status has changed.</entry>
            </row>
            <row>
              <entry><literal>CanRebootChanged</literal></entry>
              <entry><literal>bool</literal> can_reboot</entry>
              <entry>Signals the reboot status has changed.</entry>
            </row>
            <row>
              <entry><literal>PowerSaveStatusChanged</literal></entry>
              <entry><literal>bool</literal> save_power</entry>
              <entry>Signals the low power mode has changed..</entry>
            </row>
            <row>
              <entry><literal>BatteryStateChanged</literal></entry>
              <entry><literal>bool</literal> on_battery</entry>
              <entry>Signals the battery state has changed.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <table id="dbus-signals-backlight">
        <title>Signals emitted from interface <literal>org.freedesktop.PowerManagement.XXXBacklight</literal></title>
        <tgroup cols="3">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>BacklightBrightnessChanged</literal></entry>
              <entry><literal>uint</literal> percentage_brightness</entry>
              <entry>Signals the value of the current brightness has changed.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <table id="dbus-signals-widget">
        <title>Signals emitted from interface <literal>org.freedesktop.PowerManagement.XXXWidget</literal></title>
        <tgroup cols="3">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>DescriptionChanged</literal></entry>
              <entry><literal>string</literal> description</entry>
              <entry>Signals the system state description has changed.</entry>
            </row>
            <row>
              <entry><literal>IconChanged</literal></entry>
              <entry><literal>string</literal> icon</entry>
              <entry>Signals the system icon has changed.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        <emphasis>NON STANDARDISED API</emphasis>
      </para>
      <table id="dbus-signals-inhibit">
        <title>Signals emitted from interface <literal>org.freedesktop.PowerManagement.XXXInhibit</literal></title>
        <tgroup cols="3">
          <thead>
            <row>
              <entry>Name</entry>
              <entry>Return Values</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><literal>IsValidChanged</literal></entry>
              <entry><literal>bool</literal> is_valid</entry>
              <entry>Signals the inhibit valid state has changed.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </sect2>
  </sect1>
</article>

