<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- CVSID: $Id$ -->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<chapter id="dbus-interface">
  <title>DBUS Interface</title>
  <para>
    This API is currently unstable and is likely to change in the future.
  </para>

  <sect1 id="pm-intro">
    <title>Introduction</title>
    <para>
      Power Manager exposes a DBUS API for programs to obtain information about
      the DPMS state and to change it if required.
    </para>
    <para>
      The following constants are used to uniquely refer to the PowerManager
      object when making DBUS method calls:
    </para>
    <informaltable>
      <tgroup cols="2">
        <tbody>
          <row>
            <entry>DBUS Service:</entry>
            <entry><literal>org.gnome.PowerManager</literal></entry>
          </row>
          <row>
            <entry>DBUS Object Path:</entry>
            <entry><literal>/org/gnome/PowerManager</literal></entry>
          </row>
          <row>
            <entry>DBUS Interface:</entry>
            <entry><literal>org.gnome.PowerManager</literal></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="pm-Compatibility">
    <title>Compatibility</title>
    <para>
      Since gnome-power-manager version 2.14.x the API has changed in the
      following way:
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>2.14.x method name</entry>
            <entry>2.15.x method name</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>CanSuspend</literal></entry>
            <entry><literal>AllowedSuspend</literal></entry>
          </row>
          <row>
            <entry><literal>CanHibernate</literal></entry>
            <entry><literal>AllowedHibernate</literal></entry>
          </row>
          <row>
            <entry><literal>InhibitInactiveSleep</literal></entry>
            <entry><literal>Inhibit</literal></entry>
          </row>
          <row>
            <entry><literal>AllowInactiveSleep</literal></entry>
            <entry><literal>UnInhibit</literal></entry>
          </row>
          <row>
            <entry><literal>getOnAc</literal></entry>
            <entry><literal>GetOnAc</literal></entry>
          </row>
          <row>
            <entry><literal>getDpmsMode</literal></entry>
            <entry><literal>GetDpmsMode</literal></entry>
          </row>
          <row>
            <entry><literal>setDpmsMode</literal></entry>
            <entry><literal>SetDpmsMode</literal></entry>
          </row>
          <row>
            <entry><literal>(none)</literal></entry>
            <entry><literal>Reboot</literal></entry>
          </row>
          <row>
            <entry><literal>(none)</literal></entry>
            <entry><literal>AllowedShutdown</literal></entry>
          </row>
          <row>
            <entry><literal>(none)</literal></entry>
            <entry><literal>AllowedReboot</literal></entry>
          </row>
          <row>
            <entry><literal>(none)</literal></entry>
            <entry><literal>GetLowPowerMode</literal></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="pm-methods">
    <title>Methods</title>
    <para>
      These are the DBUS methods.
    </para>
    <sect2 id="pm-method-Suspend">
      <title>
        <literal>Suspend</literal>
      </title>
      <para>
        This call will attempt to suspend the system.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>Success value</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-Hibernate">
      <title>
        <literal>Hibernate</literal>
      </title>
      <para>
        This call will attempt to hibernate the system.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>Success value</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-Shutdown">
      <title>
        <literal>Shutdown</literal>
      </title>
      <para>
        This call will attempt to shutdown the system.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>Success value</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-Reboot">
      <title>
        <literal>Reboot</literal>
      </title>
      <para>
        This call will attempt to reboot the system.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>Success value</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-AllowedSuspend">
      <title>
        <literal>AllowedSuspend</literal>
      </title>
      <para>
        If the current user in the session is able to suspend, and has
        permission to do so.
        This may fail if the admin has locked down the session.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we are able to suspend</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-AllowedHibernate">
      <title>
        <literal>AllowedHibernate</literal>
      </title>
      <para>
        If the current user in the session is able to hibernate, and has
        permission to do so.
        This may fail if the admin has locked down the session.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we are able to hibernate</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-AllowedShutdown">
      <title>
        <literal>AllowedShutdown</literal>
      </title>
      <para>
        If the current user in the session is able to shutdown, and has
        permission to do so.
        This may fail if the admin has locked down the session.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we are able to shutdown</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-AllowedReboot">
      <title>
        <literal>AllowedReboot</literal>
      </title>
      <para>
        If the current user in the session is able to reboot, and has
        permission to do so.
        This may fail if the admin has locked down the session.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we are able to reboot</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-SetDpmsMode">
      <title>
        <literal>SetDpmsMode</literal>
      </title>
      <para>
        DPMS is a standard from the VESA consortium for managing the power
        supply of monitors.
	This call requests a change in the state of DPMS for the current screen.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>in</entry>
              <entry>string</entry>
              <entry></entry>
            </row>
            <row>
              <entry></entry>
              <entry>on</entry>
              <entry>100% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>standby</entry>
              <entry>&lt;80% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>suspend</entry>
              <entry>&lt;30W power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>off</entry>
              <entry>&lt;8W power usage</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-GetDpmsMode">
      <title>
        <literal>GetDpmsMode</literal>
      </title>
      <para>
        Returns the DPMS mode state.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>string</entry>
              <entry></entry>
            </row>
            <row>
              <entry></entry>
              <entry>on</entry>
              <entry>100% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>standby</entry>
              <entry>&lt;80% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>suspend</entry>
              <entry>&lt;30W power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>off</entry>
              <entry>&lt;8W power usage</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-Inhibit">
      <title>
        <literal>Inhibit</literal>
      </title>
      <para>
        Inhibits the computer from performing the idle sleep action.
        Useful if you want to do an operation of long duration without the
        computer suspending.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>in</entry>
              <entry>string</entry>
              <entry>the application name, e.g. "nautilus"</entry>
            </row>
            <row>
              <entry>in</entry>
              <entry>string</entry>
              <entry>the localised reason to inhibit, e.g. "indexing files"</entry>
            </row>
            <row>
              <entry>out</entry>
              <entry>unsigned integer</entry>
              <entry>the cookie</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para>
        A cookie is a random UINT32 used to identify the inhibit.
      </para>
    </sect2>

    <sect2 id="pm-method-UnInhibit">
      <title>
        <literal>UnInhibit</literal>
      </title>
      <para>
        Allows the computer to perform the idle sleep action.
        Applications that quit without calling this method will be
        automatically unregistered, but this is not recommended as the user
        may be warned.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>in</entry>
              <entry>unsigned integer</entry>
              <entry>the cookie</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-GetOnAc">
      <title>
        <literal>GetOnAc</literal>
      </title>
      <para>
        Finds out if the computer is on AC power, i.e. is not running on primary
        battery or UPS power.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we are on AC power</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-method-GetLowPowerMode">
      <title>
        <literal>GetLowPowerMode</literal>
      </title>
      <para>
        Finds out if the applications should use a low power mode, i.e. when this
        is true, applications should not re-index or do non-essential activity.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>boolean</entry>
              <entry>If we should use a low power mode</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>
  </sect1>

  <sect1 id="pm-signals">
    <title>Signals</title>
    <para>
      These are the DBUS signals.
    </para>
    <sect2 id="pm-signal-DpmsModeChanged">
      <title>
        <literal>DpmsModeChanged</literal>
      </title>
      <para>
        Signals the value of the current DPMS state.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>string</entry>
              <entry></entry>
            </row>
            <row>
              <entry></entry>
              <entry>on</entry>
              <entry>100% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>standby</entry>
              <entry>&lt;80% power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>suspend</entry>
              <entry>&lt;30W power usage</entry>
            </row>
            <row>
              <entry></entry>
              <entry>off</entry>
              <entry>&lt;8W power usage</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 id="pm-signal-OnAcChanged">
      <title>
        <literal>OnAcChanged</literal>
      </title>
      <para>
        Signals the new AC power state.
      </para>
      <informaltable>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Direction</entry>
              <entry>Type</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>out</entry>
              <entry>bool</entry>
              <entry>The new AC power state</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>
  </sect1>

</chapter>
