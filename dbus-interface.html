<html>
<head>
<title>
DBUS Interfaces for GNOME Power Manager
</title>
</head>
<body>
<h2>Client Methods:</h2>

<h3>bool isUserIdle ()</h3>
<p>Returns true is the user has been idle for the timeout set in gconf.</p>
<pre>status: stub</pre>

<h3>bool isRunningOnMains ()</h3>
<p>Returns true if we are running on mains (usefull for scripts)</p>
<pre>status: stub</pre>

<h3>bool isActive ()</h3>
<p>Returns true if we are running. Testing function.</p>
<pre>status: complete</pre>

<h2>Server Signals</h2>

<h3>mainsStatusChanged (bool isRunningOnMains)</h3>
<p>emitted when the mains power connection changes</p>
<pre>status: complete</pre>

<h3>userIdleStatusChanged (bool isIdle)</h3>
<p>emitted when the use is idle / no longer idle</p>
<pre>status: none</pre>

<h3>actionAboutToHappen (enum action)</h3>
<p>registered vetoers MUST respond to this signal using vetoACK, vetoNAK, vetoWait 
with ten seconds otherwise they are kicked out as vetoers (to work around 
broken apps)</p>
<pre>status: complete</pre>

<p>enum action is one of: 
SCREENSAVE = 1, POWEROFF = 2, SUSPEND = 4, HIBERNATE = 8, LOGOFF = 16, ALL =255</p>

<h3>performingAction (enum action)</h3>
<p>Just a signal, no response is required, nor allowed.</p>
<pre>status: complete</pre>

<h2>Client Signals</h2>
<h3>vetoActionRegisterInterest (enum action, gchar localizedAppname)</h3>
<p>Used for signing up for vetoing a specific action</p>
<pre>status: complete</pre>

<h3>vetoActionUnregisterInterest (enum action)</h3>
<p>Used to unregister the applications interest in a specific action.
Note: GPM will automatically unregister clients that disconnect from the bus</p>
<pre>status: semi-complete, assumes ALL</pre>

<h3>vetoACK (enum action)</h3>
Vetoer allows a specific action to take place
<pre>status: complete</pre>

<h3>vetoNACK (enum action, gchar localizedReason)</h3>
<p>Vetoer doesn't allow a specific action to take place; g-p-m SHOULD display a 
notification to the user that the action cannot take place and what the vetoing 
application is.</p>
<pre>status: complete</pre>

<h3>vetoWait (enum action, int timeout, gchar localizedReason)</h3>
<p>Vetoer asks for a timeout of timeout ms before g-p-m should try to perform the 
action again. It is legal for the vetoer to call vetoACK before the timeout.
If the (accumulated) delay amounts to more than one second, g-p-m SHOULD 
display a notification about who is blocking the action.</p>
<pre>status: not present yet</pre>

<h2>examples:</h2>
<pre>
totem 
On startup
vetoActionRegisterInterest (SCREENSAVE, "Totem media player")
And then when G-P-M wants to screensave, it issues totem with the question:
actionAboutToHappen (SCREENSAVE)
And if the video is playing fullscreen, then totem would reply:
vetoNACK (SCREENSAVE, "Fullscreen Video")
And GPM would not screen-save.
When totem had finished playing fullscreen it could do
VetoActionUnregisterInterest (SCREENSAVE)

Abiword:
If a document if unsaved:
vetoActionRegisterInterest (LOGOFF | SHUTDOWN | RESTART, "Abiword Word Processor")
When want to logoff:
actionAboutToHappen (LOGOFF)
vetoWait (LOGOFF, 500, "Saving temp. file so we can recover when we startup")
Save_abiword_document ()
vetoACK (LOGOFF)
or:
When the document is fully saved:
VetoActionUnregisterInterest (ALL)
</pre>

</body>
</html>
